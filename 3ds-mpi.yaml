openapi: 3.0.0
info:
  title: 3DS Server (MPI)
  version: '2.0'
  description: 'La presente documentación presenta el funcionamiento del servicio del 3DS Server. Expone los endpoints a consumir, los tipos datos que recibe y ejemplos de respuestas para diferentes tipos de peticiones en el flujo de autenticación de un tarjetahabiente dentro del marco del protocolo 3-D Secure.'
  contact:
    name: Evertec Placetopay
    email: desarrollo@placetopay.com
    url: 'https://www.placetopay.com/web/'
servers:
  - url: 'https://3dss-test.placetopay.com/api/threeds/v2'
    description: Sandbox
  - url: 'https://3ds-mpi.placetopay.com/api/threeds/v2'
    description: Producción
paths:
  /sessions:
    post:
      summary: Crear nueva sesión
      operationId: post-sessions
      responses:
        '200':
          description: '> Respuesta recibida: Ok'
          content:
            application/json:
              schema:
                type: object
                properties:
                  sessionToken:
                    type: string
                    description: Authentication token
                  redirectURL:
                    type: string
                    description: Redirection URL
                  transactionID:
                    type: string
                    description: Transaction's ID
                required:
                  - sessionToken
                  - redirectURL
                  - transactionID
              examples: {}
        '422':
          description: '> Respuesta recibida: Unprocessable Entity'
          content:
            application/json:
              schema:
                type: object
                properties:
                  error_number:
                    type: string
                    description: |-
                      Códigos de errores:
                      * 1000 Error de conexión a un servicio externo
                      * 1001 Respuesta no válida de un servicio externo
                      * 1002 Argumentos no válidos para iniciar una petición
                      * 1003 No se encontró un comercio asociado
                      * 1004 No se encontró una suscripción asociada
                      * 1005 La franquicia asociada no se encuentra habilitada
                      * 1006 El adquiriente asociado no se encuentra habilitado
                      * 1007 La suscripción asociada no está completamente configurada
                      * 1008 Mensaje de error recibido desde un servicio externo
                      * 1009 No hay un comercio asociado a este token, solicite un nuevo token
                      * 1010 No se encontró un servidor de directorio para el protocolo seleccionado
                      * 1011 El comercio no se encuentra habilitado
                      * 1012 El comercio no tiene un código de categoría de comerciante (MCC)
                  error_description:
                    type: string
                  errors:
                    type: string
                required:
                  - error_number
                  - error_description
                  - errors
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                acctNumber:
                  type: string
                  description: |-
                    Número de cuenta que se utilizará en la solicitud de autorización para transacciones de pago.

                    Puede estar representado por PAN.

                    **Valores aceptados:** Formato: [ISO 7812](https://es.wikipedia.org/wiki/ISO/IEC_7812)
                  minLength: 13
                  maxLength: 19
                cardExpiryDate:
                  type: string
                  description: |-
                    Fecha de vencimiento del PAN o token suministrado al Solicitante 3DS por el Titular de la Tarjeta.

                    Formato: YYMM
                  minLength: 4
                  maxLength: 4
                purchaseAmount:
                  type: string
                  description: Monto de la transacción todos los signos de puntuación eliminados.
                  maxLength: 48
                purchaseCurrency:
                  type: string
                  description: |-
                    Moneda en la que se expresa el monto de la compra.

                    > Código de moneda de tres dígitos. Ver [ISO 4217](https://es.wikipedia.org/wiki/ISO_4217)
                  minLength: 3
                  maxLength: 3
                redirectURI:
                  type: string
                  description: URL totalmente calificada del sistema donde el titular de lavtarjeta será redirigido después de completar una transacción de autenticación.
                  maxLength: 256
                  format: uri
                threeDSAuthenticationInd:
                  type: string
                  description: |-
                    Indica el tipo de solicitud de autenticación.

                    **Valores aceptados:**
                    * 01 - Transacción de pago
                    * 02 - Transacción recurrente
                    * 03 - Transacción a plazos
                  minLength: 2
                  maxLength: 2
                reference:
                  type: string
                  description: Referencia de la transacción
                  maxLength: 32
                recurringFrequency:
                  type: string
                  description: |-
                    Indica el número mínimo de días entre autorizaciones.

                    > Requerido si threeDSAuthenticationInd es igual a '02' o '03'
                  maxLength: 32
                recurringExpiry:
                  type: string
                  description: |-
                    Fecha después de la cual no se realizarán más autorizaciones.

                    > Requerido si threeDSAuthenticationInd es igual a '02' o '03'
                  minLength: 8
                  maxLength: 8
                purchaseInstalData:
                  type: string
                  description: |-
                    Indica el número máximo de autorizaciones permitidas para pagos a plazos.

                    > El valor debe ser mayor que 1. Se requiere si el Comerciante y el Titular de la Tarjeta han acordado pagos a plazos, es decir, si threeDSAuthenticationInd = 03.
                    Se omite si no se trata de una autenticación de pago a plazos.
                  minLength: 8
                  maxLength: 8
                threeDSChallengeInd:
                  type: string
                  description: |-
                    Indica si se solicita un desafío para esta transacción.

                    >Si este parámetro no es enviado en la petición, se asumirá '01 = Sin preferencia' como valor por defecto

                    **Valores aceptados:**
                    * 01 = No preference
                    * 02 = No challenge requested
                    * 03 = Challenge requested (3DS Requestor preference)
                    * 04 = Challenge requested (Mandate)
                    * 05 = No challenge requested (transactional risk analysis is already performed)
                    * 06 = No challenge requested (Data share only)
                    * 07 = No challenge requested (strong consumer authentication is already performed)
                    * 08 = No challenge requested (utilise whitelist exemption if no challenge required)
                    * 09 = Challenge requested (whitelist prompt requested if challenge required)
                  minLength: 2
                  maxLength: 2
                threeDSAuthenticationInfo:
                  $ref: '#/components/schemas/threeDSAuthenticationInfoProperties'
                threeDSRequestorID:
                  type: string
                  description: |-
                    Identificador asociado por el Directory Server al Solicitante 3DS.

                    > Cualquier DS individual puede imponer requisitos específicos de formato y caracteres en el contenido de este campo.
                  maxLength: 35
                acctInfo:
                  $ref: '#/components/schemas/acctInfoProperties'
                acctID:
                  type: string
                  description: Identificador de la cuenta del tarjetahabiente
                  maxLength: 64
                billAddrCity:
                  type: string
                  description: Ciudad de la dirección de facturación
                  maxLength: 50
                billAddrCountry:
                  type: string
                  description: 'País de la dirección de facturación Valores aceptados: Formato: [ISO 3166-1](https://es.wikipedia.org/wiki/ISO_3166-1)'
                  maxLength: 3
                billAddrLine1:
                  type: string
                  description: Línea 1 de la dirección de facturación
                  maxLength: 50
                billAddrLine2:
                  type: string
                  description: Línea 2 de la dirección de facturación
                  maxLength: 50
                billAddrLine3:
                  type: string
                  description: Línea 3 de la dirección de facturación
                  maxLength: 50
                billAddrPostCode:
                  type: string
                  description: Código Postal de la dirección de facturación
                  maxLength: 16
                billAddrState:
                  type: string
                  description: 'Estado de la dirección de facturación. Valores aceptados: Formato: [ISO 3166-2](https://es.wikipedia.org/wiki/ISO_3166-1)'
                  maxLength: 3
                email:
                  type: string
                  description: Correo electrónico del tarjetahabiente
                  format: email
                  maxLength: 254
                homePhone:
                  $ref: '#/components/schemas/PhoneProperties'
                mobilePhone:
                  $ref: '#/components/schemas/PhoneProperties'
                cardholderName:
                  type: string
                  description: Nombre del titular de la tarjeta
                  minLength: 2
                  maxLength: 45
                shipAddrCity:
                  type: string
                  description: Ciudad de la dirección de envío
                  maxLength: 50
                shipAddrCountry:
                  type: string
                  description: 'País de la dirección de envío. Valores aceptados: Formato: [ISO 3166-1](https://es.wikipedia.org/wiki/ISO_3166-1)'
                  minLength: 3
                  maxLength: 3
                shipAddrLine1:
                  type: string
                  description: Línea 1 de la dirección de envío
                  maxLength: 50
                shipAddrLine2:
                  type: string
                  description: Línea 2 de la dirección de envío
                  maxLength: 50
                shipAddrLine3:
                  type: string
                  description: Línea 3 de la dirección de envío
                  maxLength: 50
                shipAddrPostCode:
                  type: string
                  description: Postal code de la dirección de envío
                  maxLength: 16
                shipAddrState:
                  type: string
                  description: |-
                    Estado de la dirección de envío
                    Valores aceptados: Formato: [ISO 3166-2](https://es.wikipedia.org/wiki/ISO_3166-1)
                  maxLength: 3
                workPhone:
                  $ref: '#/components/schemas/PhoneProperties'
                merchantRiskIndicator:
                  $ref: '#/components/schemas/merchantRiskIndicatorProperties'
              required:
                - acctNumber
                - cardExpiryDate
                - purchaseAmount
                - purchaseCurrency
                - redirectURI
            examples:
              Respuesta exitosa (Ejemplo 1 – con la mínima información requerida):
                value:
                  acctNumber: '4005580000000040'
                  cardExpiryDate: '2411'
                  purchaseAmount: '8.25'
                  redirectURI: 'http://www.placetopay.com'
                  purchaseCurrency: COP
              Respuesta exitosa (Ejemplo 2 – con información de facturación del tarjehabiente):
                value:
                  acctNumber: '4012000000001097'
                  cardExpiryDate: '2010'
                  purchaseAmount: '15000'
                  redirectURI: 'http://www.placetopay.com'
                  purchaseCurrency: COP
                  cardholderName: John Doe
                  email: john.doe@example.com
                  billAddrCity: Medellin
                  billAddrCountry: COP
                  billAddrLine1: 'Cl 72 No. 15 F-07, El libertador'
                  billAddrPostCode: '76001'
              Respuesta exitosa (Ejemplo 3 – con información adicional de la tarjeta):
                value:
                  acctNumber: '4012000000001097'
                  cardExpiryDate: '2010'
                  purchaseAmount: '15000'
                  redirectURI: 'http://www.placetopay.com'
                  purchaseCurrency: COP
                  acctInfo:
                    chAccAgeInd: '03'
                    chAccChange: '20200801'
                    chAccChangeInd: '02'
                    chAccDate: '20200824'
                    chAccPwChange: '20200801'
                    chAccPwChangeInd: '01'
                    nbPurchaseAccount: '0'
                    provisionAttemptsDay: '1'
              Respuesta exitosa (Ejemplo 4 – con información de entrega del tarjehabiente):
                value:
                  acctNumber: '4012000000001097'
                  cardExpiryDate: '2010'
                  purchaseAmount: '15000'
                  redirectURI: 'http://www.placetopay.com'
                  purchaseCurrency: COP
                  shipAddrCity: Medellin
                  shipAddrCountry: COP
                  shipAddrLine1: 'Cl 72 No. 15 F-07, El libertador'
                  shipAddrPostCode: '76001'
              Respuesta no exitosa (error de validación):
                value:
                  acctNumber: '4005580000000040'
                  cardExpiryDate: '2411'
                  purchaseAmount: '8.25'
                  redirectURI: 'http://www.placetopay.com'
                  email: john.doe@example.com
        description: '> Datos a enviar en el servicio'
      description: '> Servicio para iniciar una sesión del flujo de 3DS'
      parameters: []
      security:
        - Authorization: []
      tags:
        - Sessions
  '/transactions/{transactionID}':
    parameters:
      - schema:
          type: string
        name: transactionID
        in: path
        required: true
        description: '> Identificador de la transacción obtenido en la respuesta del endpoint de sessión.'
    get:
      summary: Obtener transacción
      operationId: get-transactions-transactionID
      responses:
        '200':
          description: '> Respuesta recibida OK'
          content:
            application/json:
              schema:
                type: object
                properties:
                  transStatus:
                    type: string
                  eci:
                    type: string
                  acsTransID:
                    type: string
                  threeDSServerTransID:
                    type: string
                  authenticationValue:
                    type: string
              examples:
                Respuesta exitosa:
                  value:
                    transStatus: string
                    eci: string
                    acsTransID: string
                    threeDSServerTransID: string
                    authenticationValue: string
      description: '> Servicio para obtener información de una transacción'
      tags:
        - Transaction
      parameters: []
components:
  schemas:
    PhoneProperties:
      title: PhoneProperties
      type: object
      x-examples:
        Valores aceptados:
          cc: '1'
          subscriber: '1234567899'
      properties:
        cc:
          type: string
          minLength: 1
          maxLength: 3
        subscriber:
          type: string
          maxLength: 15
      required:
        - cc
        - subscriber
      description: '> Valores aceptados según especificación [ITU-E.164](https://www.itu.int/rec/dologin_pub.asp?lang=e&id=T-REC-E.164-201011-I!!PDF-S&type=items)'
      x-tags:
        - Models
    threeDSAuthenticationInfoProperties:
      title: threeDSAuthenticationInfo
      type: object
      description: '> Información sobre cómo el Solicitante 3DS autenticó al titular de la tarjeta antes o durante la transacción.'
      properties:
        threeDSReqAuthData:
          type: string
          maxLength: 20000
        threeDSReqAuthMethod:
          type: string
          description: Mecanismo utilizado por el Titular de la tarjeta para autenticarse ante el 3DS Requestor.
        threeDSReqAuthTimestamp:
          type: string
          description: |-
            Fecha y hora en UTC de la autenticación del titular de la tarjeta.

            Formato YYYYMMDDHHMM
          minLength: 12
          maxLength: 12
      x-tags:
        - Models
    acctInfoProperties:
      title: acctInfo
      type: object
      description: '> Información adicional sobre la cuenta del titular de la tarjeta.'
      properties:
        chAccAgeInd:
          type: string
          description: |-
            Longitud del tiempo en que la cuenta fué creada en el sitio web del comercio

            **Valores aceptados:**
            * 01 - Sin cuenta (invitado)
            * 02 - Creada durante la transacción
            * 03 - Menos de 30 días
            * 04 - Entre 30 y 60 días
            * 05 - Más de 60 días
          maxLength: 2
          minLength: 2
        chAccChange:
          type: string
          description: |-
            Fecha del último cambio efectuado en la cuenta del tarjetahabiente en el sitio web del comercio. Incluyendo dirección de envío, dirección de pago.

            **Valores aceptados:** Fecha en formato YYYYMMDD
          minLength: 8
          maxLength: 8
        chAccChangeInd:
          type: string
          description: |-
            Longitud del tiempo desde el último cambio efectuado en la cuenta en el sitio web del comercio.

            **Valores aceptados:**
            * 01 - Cambiado durante la transacción
            * 02 - Menos de 30 días
            * 03 - Entre 30 y 60 días
            * 04 - Más de 60 días
          minLength: 2
          maxLength: 2
        chAccDate:
          type: string
          description: |-
            Fecha en la que se creó la cuenta en el sitio web del comercio.

            **Valores aceptados:** Fecha en formato YYYYMMDD
          minLength: 8
          maxLength: 8
        chAccPwChange:
          type: string
          description: |-
            Fecha en la que se realizó el último cambio o recuperación de contraseña.

            **Valores aceptados:** Fecha en formato YYYYMMDD
          minLength: 8
          maxLength: 8
        chAccPwChangeInd:
          type: string
          description: |-
            Longitud de tiempo desde el último cambio o recuperación de contraseña.

            **Valores aceptados:**
            * 01 - Sin cambios
            * 02 - Cambiado durante la transacción
            * 03 - Menos de 30 días
            * 04 - Entre 30 y 60 días
            * 05 - Más de 60 días
          minLength: 2
          maxLength: 2
        nbPurchaseAccount:
          type: string
          description: Número de compras durante los últimos 6 meses.
          maxLength: 4
        provisionAttemptsDay:
          type: string
          description: Número de intentos de agregar tarjetas en las últimas 24 horas.
          maxLength: 3
        txnActivityDay:
          type: string
          description: Número de transacciones (exitosas y abandonadas) para esta cuenta en las últimas 24 horas.
          maxLength: 3
        txnActivityYear:
          type: string
          description: Número de transacciones (exitosas y abandonadas) para esta cuenta en el último año.
          maxLength: 3
        paymentAccAge:
          type: string
          description: |-
            Fecha en la que el método de pago se agregó a la cuenta del usuario en el sitio web del comercio.

            **Valores aceptados:** Fecha en formato YYYYMMDD
          minLength: 8
          maxLength: 8
        paymentAccInd:
          type: string
          description: |-
            Longitud de tiempo desde que el método de pago fué enrolado en la cuenta en el sitio web del comercio.

            **Valores aceptados:**
            * 01 - Sin cuenta (invitado)
            * 02 - Durante la transacción
            * 03 - Menos de 30 días
            * 04 - Entre 30 y 60 días
            * 05 - Más de 60 días
          minLength: 2
          maxLength: 2
        shipAddressUsage:
          type: string
          description: |-
            Fecha en la que la dirección de entrega fue usada por primera vez en el sitio web del comercio.

            **Valores aceptados:** Fecha en formato YYYYMMDD
          minLength: 8
          maxLength: 8
        shipAddressUsageInd:
          type: string
          description: |-
            Longitud de tiempo desde que la dirección de entrega fue usada por primera vez en el sitio web del comercio.

            **Valores aceptados:**
            * 01 - Esta transacción
            * 02 - Menos de 30 días
            * 03 - Entre 30 y 60 días
            * 04 - Más de 60 días
          minLength: 2
          maxLength: 2
        shipNameIndicator:
          type: string
          description: |-
            Indica si el nombre del titular de la tarjeta es igual al nombre de envío usado en esta transacción

            **Valores aceptados:**
            01 - Nombre de cuenta idéntico al nombre de envío.
            * 02 - Nombre de cuenta diferente al nombre de envío.
          minLength: 2
          maxLength: 2
        suspiciousAccActivity:
          type: string
          description: |-
            Indica si el comercio ha experimentado actividad sospechosa (incluido fraude previo) en la cuenta del titular de la tarjeta.

            **Valores aceptados:**
            * 01 - No se ha observado actividad sospechosa.
            * 02 - Se ha observado actividad sospechosa.
          minLength: 2
          maxLength: 2
      x-tags:
        - Models
      x-examples:
        example-1:
          chAccAgeInd: st
          chAccChange: stringst
          chAccChangeInd: st
          chAccDate: stringst
          chAccPwChange: stringst
          chAccPwChangeInd: st
          nbPurchaseAccount: stri
          provisionAttemptsDay: str
          txnActivityDay: str
          txnActivityYear: str
          paymentAccAge: stringst
          paymentAccInd: st
          shipAddressUsage: stringst
          shipAddressUsageInd: st
          shipNameIndicator: st
          suspiciousAccActivity: st
    merchantRiskIndicatorProperties:
      title: merchantRiskIndicator
      type: object
      description: '> Evaluación del comerciante del nivel de riesgo de fraude para la autenticación específica tanto para el titular de la tarjeta como para la autenticación que se está realizando.'
      properties:
        deliveryEmailAddress:
          type: string
          description: 'Para entrega electrónica, la dirección de correo electrónico a la que se entregó la mercancía.'
          maxLength: 254
        deliveryTimeframe:
          type: string
          description: |-
            Indica el plazo de entrega de la mercancía.

            **Valores aceptados:**
            * 01 – Entrega electrónica
            * 02 – Entrega el mismo día
            * 03 – Envío nocturno
            * 04 – Entrega en dos días o más
          maxLength: 2
          minLength: 2
        giftCardAmount:
          type: string
          description: 'Para compras con tarjeta de regalo o prepago, el monto total de la compra de tarjetas de regalo o prepago en unidades principales (por ejemplo, 123,45 USD es 123).'
          maxLength: 15
        giftCardCount:
          type: string
          description: 'Para compras con tarjeta de regalo o prepago, recuento total de tarjetas, códigos de regalo o prepago individuales comprados.'
          minLength: 2
          maxLength: 2
        giftCardCurr:
          type: string
          description: |-
            Para compras con tarjeta de regalo o prepago, código de moneda de tres dígitos ISO 4217 de la tarjeta de regalo.
            Formato: [ISO 4217](https://es.wikipedia.org/wiki/ISO_4217)
          minLength: 3
          maxLength: 3
        preOrderDate:
          type: string
          description: |-
            Para una compra pre-ordenada, la fecha esperada en que la mercancía estará disponible.

            Formato: YYYYMMDD
          minLength: 8
          maxLength: 8
        preOrderPurchaseInd:
          type: string
          description: |-
            Indica si el Titular de la tarjeta está realizando un pedido de mercancía con una disponibilidad futura o una fecha de lanzamiento.

            **Valores aceptados:**
            * 01 - Mercancía disponible
            * 02 - Disponibilidad futura
          minLength: 2
          maxLength: 2
        reorderItemsInd:
          type: string
          description: |-
            Indica si el titular de la tarjeta está reordenando mercancía comprada anteriormente.

            **Valores aceptados:**
            * 01 – Primera vez
            * 02 – Reordenado
          minLength: 2
          maxLength: 2
        shipIndicator:
          type: string
          description: |-
            Indica el método de envío elegido para la transacción.

            **Valores aceptados:**
            * 01 = Enviar a la dirección de facturación del titular de la tarjeta
            * 02 = Enviar a otra dirección verificada registrada con el comerciante
            * 03 = Envío a una dirección diferente a la dirección de facturación del titular de la tarjeta
            * 04 = "Enviar a la tienda" / Recoger en la tienda local (la dirección de la tienda se completará en los campos de dirección de envío)
            * 05 = Productos digitales (incluye servicios en línea, tarjetas de regalo electrónicas y códigos de canje)
            * 06 = Boletos de viaje y eventos, no enviados
            * 07 = Otro (por ejemplo, juegos, servicios digitales no enviados, suscripciones a emedia, etc.)
          minLength: 2
          maxLength: 2
      x-tags:
        - Models
  securitySchemes:
    Authorization:
      type: http
      scheme: bearer
security:
  - Authorization: []
tags:
  - name: Sessions
  - name: Transaction
